<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåŠ¨å”®è´§æœºç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .product-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .product-card.selected {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            transform: scale(1.05);
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .product-price {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .product-stock {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }

        input, select, button {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: bold;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸª è‡ªåŠ¨å”®è´§æœºç³»ç»Ÿ</h1>
            <p>æ™ºèƒ½å”®è´§ï¼Œä¾¿æ·ç”Ÿæ´»</p>
        </header>

        <div class="main-content">
            <!-- å•†å“å±•ç¤ºé¢æ¿ -->
            <section class="panel">
                <h2>ğŸ“¦ å•†å“åˆ—è¡¨</h2>
                <div class="product-grid" id="productGrid">
                    <!-- å•†å“å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProducts">0</div>
                        <div class="stat-label">å•†å“ç§ç±»</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalStock">0</div>
                        <div class="stat-label">æ€»åº“å­˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalValue">Â¥0</div>
                        <div class="stat-label">æ€»ä»·å€¼</div>
                    </div>
                </div>
            </section>

            <!-- æ“ä½œé¢æ¿ -->
            <section class="panel">
                <h2>ğŸ›’ è´­ä¹°å•†å“</h2>
                <form id="purchaseForm">
                    <div class="form-group">
                        <label for="purchaseProduct">é€‰æ‹©å•†å“</label>
                        <select id="purchaseProduct" required>
                            <option value="">è¯·é€‰æ‹©å•†å“</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="purchaseQuantity">è´­ä¹°æ•°é‡</label>
                        <input type="number" id="purchaseQuantity" min="1" value="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="purchaseMoney">æ”¯ä»˜é‡‘é¢ (Â¥)</label>
                        <input type="number" id="purchaseMoney" min="0" step="0.01" placeholder="è¯·è¾“å…¥æ”¯ä»˜é‡‘é¢" required>
                    </div>
                    
                    <button type="submit">ç«‹å³è´­ä¹°</button>
                </form>

                <div id="purchaseMessage"></div>

                <h2 style="margin-top: 30px;">ğŸ“¦ è¡¥è´§ç®¡ç†</h2>
                <form id="restockForm">
                    <div class="form-group">
                        <label for="restockProduct">é€‰æ‹©å•†å“</label>
                        <select id="restockProduct" required>
                            <option value="">è¯·é€‰æ‹©å•†å“</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="restockQuantity">è¡¥è´§æ•°é‡</label>
                        <input type="number" id="restockQuantity" min="1" value="10" required>
                    </div>
                    
                    <button type="submit">ç¡®è®¤è¡¥è´§</button>
                </form>

                <div id="restockMessage"></div>

                <div class="button-group">
                    <button onclick="refreshDisplay()">ğŸ”„ åˆ·æ–°æ˜¾ç¤º</button>
                    <button onclick="resetMachine()">ğŸ”§ é‡ç½®å”®è´§æœº</button>
                </div>
            </section>
        </div>
    </div>

    <script>
        // å•†å“ç±»
        class Product {
            constructor(name, price, stock) {
                this.name = name;
                this.price = price;
                this.stock = stock;
            }

            addStock(amount) {
                this.stock += amount;
            }

            reduceStock(amount) {
                if (this.stock >= amount) {
                    this.stock -= amount;
                    return true;
                }
                return false;
            }
        }

        // å”®è´§æœºç±»
        class SellingMachine {
            constructor() {
                this.products = [];
                this.initDefaultProducts();
            }

            initDefaultProducts() {
                this.products.push(new Product('å¯ä¹', 3.5, 10));
                this.products.push(new Product('é›ªç¢§', 3.5, 8));
                this.products.push(new Product('çŸ¿æ³‰æ°´', 2.0, 15));
                this.products.push(new Product('è–¯ç‰‡', 5.0, 6));
                this.products.push(new Product('å·§å…‹åŠ›', 4.5, 12));
            }

            listProducts() {
                return this.products;
            }

            restock(productName, amount) {
                const product = this.products.find(p => p.name === productName);
                if (product) {
                    product.addStock(amount);
                    return { success: true, message: `${productName} è¡¥è´§æˆåŠŸï¼Œæ–°å¢ ${amount} ä»¶` };
                } else {
                    return { success: false, message: `æœªæ‰¾åˆ°å•†å“: ${productName}` };
                }
            }

            sell(productName, quantity, money) {
                const product = this.products.find(p => p.name === productName);
                
                if (!product) {
                    return { success: false, message: `æœªæ‰¾åˆ°å•†å“: ${productName}` };
                }

                if (product.stock < quantity) {
                    return { success: false, message: `åº“å­˜ä¸è¶³ï¼Œå½“å‰åº“å­˜: ${product.stock}ï¼Œéœ€è¦: ${quantity}` };
                }

                const totalPrice = product.price * quantity;
                
                if (money < totalPrice) {
                    return { 
                        success: false, 
                        message: `é‡‘é¢ä¸è¶³ï¼Œéœ€è¦: Â¥${totalPrice.toFixed(2)}ï¼Œæ”¯ä»˜: Â¥${money.toFixed(2)}ï¼Œè¿˜å·®: Â¥${(totalPrice - money).toFixed(2)}` 
                    };
                }

                product.reduceStock(quantity);
                const change = money - totalPrice;
                
                return { 
                    success: true, 
                    message: `è´­ä¹°æˆåŠŸï¼æ‰¾é›¶: Â¥${change.toFixed(2)}`,
                    change: change
                };
            }

            getStats() {
                const totalProducts = this.products.length;
                const totalStock = this.products.reduce((sum, p) => sum + p.stock, 0);
                const totalValue = this.products.reduce((sum, p) => sum + (p.price * p.stock), 0);
                
                return { totalProducts, totalStock, totalValue };
            }
        }

        // åˆå§‹åŒ–å”®è´§æœº
        let machine = new SellingMachine();

        // æ˜¾ç¤ºå•†å“å¡ç‰‡
        function displayProducts() {
            const productGrid = document.getElementById('productGrid');
            const products = machine.listProducts();
            
            productGrid.innerHTML = '';
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">Â¥${product.price.toFixed(2)}</div>
                    <div class="product-stock">åº“å­˜: ${product.stock}</div>
                `;
                
                card.addEventListener('click', () => selectProduct(product.name));
                productGrid.appendChild(card);
            });

            updateStats();
            updateSelectOptions();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const stats = machine.getStats();
            document.getElementById('totalProducts').textContent = stats.totalProducts;
            document.getElementById('totalStock').textContent = stats.totalStock;
            document.getElementById('totalValue').textContent = `Â¥${stats.totalValue.toFixed(0)}`;
        }

        // æ›´æ–°ä¸‹æ‹‰é€‰é¡¹
        function updateSelectOptions() {
            const products = machine.listProducts();
            const purchaseSelect = document.getElementById('purchaseProduct');
            const restockSelect = document.getElementById('restockProduct');
            
            // ä¿å­˜å½“å‰é€‰æ‹©
            const currentPurchase = purchaseSelect.value;
            const currentRestock = restockSelect.value;
            
            // æ›´æ–°è´­ä¹°é€‰é¡¹
            purchaseSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å•†å“</option>';
            restockSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å•†å“</option>';
            
            products.forEach(product => {
                if (product.stock > 0) {
                    purchaseSelect.innerHTML += `<option value="${product.name}">${product.name} - Â¥${product.price.toFixed(2)} (åº“å­˜: ${product.stock})</option>`;
                }
                restockSelect.innerHTML += `<option value="${product.name}">${product.name}</option>`;
            });
            
            // æ¢å¤é€‰æ‹©
            purchaseSelect.value = currentPurchase;
            restockSelect.value = currentRestock;
        }

        // é€‰æ‹©å•†å“
        function selectProduct(productName) {
            document.getElementById('purchaseProduct').value = productName;
            
            // é«˜äº®é€‰ä¸­çš„å¡ç‰‡
            document.querySelectorAll('.product-card').forEach(card => {
                card.classList.remove('selected');
                if (card.querySelector('.product-name').textContent === productName) {
                    card.classList.add('selected');
                }
            });
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(elementId, message, isSuccess) {
            const messageEl = document.getElementById(elementId);
            messageEl.innerHTML = `<div class="message ${isSuccess ? 'success' : 'error'}">${message}</div>`;
            
            // 3ç§’åè‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯
            setTimeout(() => {
                messageEl.innerHTML = '';
            }, 3000);
        }

        // è´­ä¹°è¡¨å•æäº¤
        document.getElementById('purchaseForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const productName = document.getElementById('purchaseProduct').value;
            const quantity = parseInt(document.getElementById('purchaseQuantity').value);
            const money = parseFloat(document.getElementById('purchaseMoney').value);
            
            const result = machine.sell(productName, quantity, money);
            showMessage('purchaseMessage', result.message, result.success);
            
            if (result.success) {
                displayProducts();
                // æ¸…ç©ºè¡¨å•
                document.getElementById('purchaseForm').reset();
            }
        });

        // è¡¥è´§è¡¨å•æäº¤
        document.getElementById('restockForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const productName = document.getElementById('restockProduct').value;
            const quantity = parseInt(document.getElementById('restockQuantity').value);
            
            const result = machine.restock(productName, quantity);
            showMessage('restockMessage', result.message, result.success);
            
            if (result.success) {
                displayProducts();
                // æ¸…ç©ºè¡¨å•
                document.getElementById('restockForm').reset();
            }
        });

        // åˆ·æ–°æ˜¾ç¤º
        function refreshDisplay() {
            displayProducts();
            showMessage('purchaseMessage', 'æ˜¾ç¤ºå·²åˆ·æ–°', true);
        }

        // é‡ç½®å”®è´§æœº
        function resetMachine() {
            if (confirm('ç¡®å®šè¦é‡ç½®å”®è´§æœºå—ï¼Ÿæ‰€æœ‰æ•°æ®å°†æ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚')) {
                machine = new SellingMachine();
                displayProducts();
                document.getElementById('purchaseForm').reset();
                document.getElementById('restockForm').reset();
                showMessage('purchaseMessage', 'å”®è´§æœºå·²é‡ç½®', true);
            }
        }

        // å½“é€‰æ‹©å•†å“å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨è®¡ç®—é‡‘é¢
        document.getElementById('purchaseProduct').addEventListener('change', (e) => {
            const productName = e.target.value;
            const quantity = parseInt(document.getElementById('purchaseQuantity').value) || 1;
            
            if (productName) {
                const product = machine.listProducts().find(p => p.name === productName);
                if (product) {
                    const total = product.price * quantity;
                    document.getElementById('purchaseMoney').value = total.toFixed(2);
                }
            }
        });

        document.getElementById('purchaseQuantity').addEventListener('input', (e) => {
            const productName = document.getElementById('purchaseProduct').value;
            const quantity = parseInt(e.target.value) || 1;
            
            if (productName) {
                const product = machine.listProducts().find(p => p.name === productName);
                if (product) {
                    const total = product.price * quantity;
                    document.getElementById('purchaseMoney').value = total.toFixed(2);
                }
            }
        });

        // åˆå§‹åŒ–æ˜¾ç¤º
        displayProducts();
    </script>
</body>
</html>